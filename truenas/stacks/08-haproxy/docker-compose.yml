---
services:
  lego-auto:
    env_file:
      - path: ./secrets.env
        required: true
    image: ghcr.io/bjw-s/lego-auto:v0.3.0
    user: "99:99"
    environment:
      TZ: Europe/Warsaw
      LA_DATADIR: /certs
      LA_CACHEDIR: /certs/.cache
      LA_PROVIDER: cloudflare
      LA_DOMAINS: "*.ishioni.casa"
    volumes:
      - certs:/certs
  haproxy:
    image: docker.io/haproxy:3.1.0
    container_name: haproxy
    restart: unless-stopped
    environment:
      TZ: Europe/Warsaw
    networks:
      traefik_macvlan:
        ipv4_address: ${MACVLAN_ADDRESS}
    expose:
      - &appPort ${APP_PORT}
      - &statsPort ${HAPROXY_PORT}
    volumes:
      - ./config/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
      - certs:/etc/haproxy/certs

volumes:
  certs:

networks:
  apps:
    external: true
  traefik_macvlan:
    external: true
